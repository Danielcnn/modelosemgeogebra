<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Método do Ponto Fixo</title>
    <style>
        /* (Manter os estilos CSS anteriores) */
    </style>
</head>
<body>
    <!-- (Manter o HTML anterior) -->

    <script>
        // (Manter as funções anteriores até a função runMethod)
        
        function runMethod(fStr, gStr, x0, tolerance, maxIter) {
            try {
                // Criar as funções
                const f = new Function('x', `return ${fStr.replace(/x/g, '(x)')};`);
                const g = new Function('x', `return ${gStr.replace(/x/g, '(x)')};`);
                
                // Inicializar variáveis
                let x = x0;
                let iter = 0;
                let error = Infinity;
                let tableHTML = `
                    <table>
                        <tr>
                            <th>Iteração</th>
                            <th>x_n</th>
                            <th>Erro</th>
                        </tr>
                        <tr>
                            <td>0</td>
                            <td>${x.toFixed(6)}</td>
                            <td>-</td>
                        </tr>
                `;
                
                // Loop de iterações
                while (error > tolerance && iter < maxIter) {
                    const xNew = g(x);
                    error = Math.abs(xNew - x);
                    iter++;
                    x = xNew;
                    
                    tableHTML += `
                        <tr>
                            <td>${iter}</td>
                            <td>${x.toFixed(6)}</td>
                            <td>${error.toFixed(6)}</td>
                        </tr>
                    `;
                    
                    if (!isFinite(x)) {
                        throw new Error('Divergência detectada!');
                    }
                }
                
                tableHTML += `</table>`;
                document.getElementById('iteration-table').innerHTML = tableHTML;
                
                // Mostrar resultado final
                let resultHTML;
                if (error <= tolerance) {
                    resultHTML = `<p class="success">Convergência para x = ${x.toFixed(6)} após ${iter} iterações.</p>`;
                } else {
                    resultHTML = `<p class="error">Não convergiu em ${maxIter} iterações (Erro final: ${error.toFixed(6)}).</p>`;
                }
                
                resultHTML += `<p>Função utilizada: g(x) = ${gStr}</p>`;
                document.getElementById('final-result').innerHTML = resultHTML;
                document.getElementById('results').style.display = 'block';
                
            } catch (e) {
                alert(`Erro: ${e.message}`);
                console.error(e);
            }
        }
    </script>
</body>
</html>
